#!/bin/sh
#
# DO NOT EDIT THIS FILE
#
# This is a build script generated by
# [BuildStream](https://wiki.gnome.org/Projects/BuildStream/).
#
# Builds the module manual-build.

set -e

# Prepare the build environment
echo 'Building manual-build'

if [ -d '/buildstream/build' ]; then
    rm -rf '/buildstream/build'
fi

if [ -d '/buildstream/install' ]; then
    rm -rf '/buildstream/install'
fi

mkdir -p '/buildstream/build'
mkdir -p '/buildstream/install'

if [ -d "$SRCDIR/manual-build/" ]; then
    cp -a "$SRCDIR/manual-build/." '/buildstream/build'
fi
cd '/buildstream/build'

export PREFIX='/buildstream/install'

export HOME=/tmp LC_ALL=C LOGNAME=tomjon MAKEFLAGS=-j1 PATH=/usr/bin:/bin:/usr/sbin:/sbin SHELL=/bin/sh TERM=dumb TZ=UTC USER=tomjon USERNAME=tomjon V=1 

# Build the module
(set -ex; echo 'Hi :)'
) || exit 1
(set -ex; find "/buildstream/install" -type f \
  '(' -perm -111 -o -name '*.so*' \
      -o -name '*.cmxs' -o -name '*.node' ')' \
  -exec sh -ec \
  'read -n4 hdr <"$1" # check for elf header
   if [ "$hdr" != "$(printf \\x7fELF)" ]; then
       exit 0
   fi
   debugfile="/buildstream/install/usr/lib/debug/$(basename "$1")"
   mkdir -p "$(dirname "$debugfile")"
   objcopy --only-keep-debug "$1" "$debugfile"
   chmod 644 "$debugfile"
   strip --remove-section=.comment --remove-section=.note --strip-unneeded "$1"
   objcopy --add-gnu-debuglink "$debugfile" "$1"' - {} ';'
) || exit 1


rm -rf '/buildstream/build'

# Install the module
echo 'Installing manual-build'

(cd '/buildstream/install'; find . | cpio -umdp /)